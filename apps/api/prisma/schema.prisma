generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                         String                      @id @default(uuid())
  email                      String                      @unique
  password                   String?
  firstName                  String
  lastName                   String
  playaName                  String?
  profilePicture             String?
  role                       UserRole                    @default(PARTICIPANT)
  isEmailVerified            Boolean                     @default(false)
  verificationToken          String?
  resetToken                 String?
  resetTokenExpiry           DateTime?
  createdAt                  DateTime                    @default(now())
  updatedAt                  DateTime                    @updatedAt
  allowDeferredDuesPayment   Boolean                     @default(false)
  allowEarlyRegistration     Boolean                     @default(false)
  allowNoJob                 Boolean                     @default(false)
  allowRegistration          Boolean                     @default(true)
  city                       String?
  country                    String?
  emergencyContact           String?
  internalNotes              String?
  phone                      String?
  stateProvince              String?
  loginCode                  String?
  loginCodeExpiry            DateTime?
  campingOptionRegistrations CampingOptionRegistration[]
  payments                   Payment[]
  registrations              Registration[]

  @@map("users")
}

model Camp {
  id             String          @id @default(uuid())
  name           String
  description    String?
  startDate      DateTime
  endDate        DateTime
  location       String
  capacity       Int
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  campingOptions CampingOption[]
  shifts         Shift[]

  @@map("camps")
}

model CampingOption {
  id                 String                      @id @default(uuid())
  name               String
  description        String?
  enabled            Boolean                     @default(true)
  workShiftsRequired Int                         @default(0)
  participantDues    Float
  staffDues          Float
  maxSignups         Int                         @default(0)
  createdAt          DateTime                    @default(now())
  updatedAt          DateTime                    @updatedAt
  campId             String
  jobCategoryIds     String[]
  fields             CampingOptionField[]
  registrations      CampingOptionRegistration[]
  camp               Camp                        @relation(fields: [campId], references: [id])

  @@map("camping_options")
}

model CampingOptionField {
  id              String                    @id @default(uuid())
  displayName     String
  description     String?
  dataType        FieldType
  required        Boolean                   @default(false)
  maxLength       Int?
  minValue        Float?
  maxValue        Float?
  createdAt       DateTime                  @default(now())
  updatedAt       DateTime                  @updatedAt
  campingOptionId String
  fieldValues     CampingOptionFieldValue[]
  campingOption   CampingOption             @relation(fields: [campingOptionId], references: [id], onDelete: Cascade)

  @@map("camping_option_fields")
}

model CampingOptionFieldValue {
  id             String                    @id @default(uuid())
  value          String
  createdAt      DateTime                  @default(now())
  updatedAt      DateTime                  @updatedAt
  fieldId        String
  registrationId String
  field          CampingOptionField        @relation(fields: [fieldId], references: [id], onDelete: Cascade)
  registration   CampingOptionRegistration @relation(fields: [registrationId], references: [id], onDelete: Cascade)

  @@map("camping_option_field_values")
}

model CampingOptionRegistration {
  id              String                    @id @default(uuid())
  createdAt       DateTime                  @default(now())
  updatedAt       DateTime                  @updatedAt
  userId          String
  campingOptionId String
  fieldValues     CampingOptionFieldValue[]
  campingOption   CampingOption             @relation(fields: [campingOptionId], references: [id])
  user            User                      @relation(fields: [userId], references: [id])

  @@map("camping_option_registrations")
}

model JobCategory {
  id             String   @id @default(uuid())
  name           String   @unique
  description    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  alwaysRequired Boolean  @default(false)
  location       String?
  staffOnly      Boolean  @default(false)
  jobs           Job[]

  @@map("job_categories")
}

model Job {
  id             String      @id @default(uuid())
  name           String
  description    String?
  location       String
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  categoryId     String
  alwaysRequired Boolean     @default(false)
  staffOnly      Boolean     @default(false)
  category       JobCategory @relation(fields: [categoryId], references: [id])
  shifts         Shift[]

  @@map("jobs")
}

model Shift {
  id               String         @id @default(uuid())
  startTime        DateTime
  endTime          DateTime
  maxRegistrations Int
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  campId           String
  jobId            String
  dayOfWeek        DayOfWeek
  registrations    Registration[]
  camp             Camp           @relation(fields: [campId], references: [id])
  job              Job            @relation(fields: [jobId], references: [id])

  @@map("shifts")
}

model Registration {
  id        String             @id @default(uuid())
  status    RegistrationStatus @default(PENDING)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  userId    String
  shiftId   String
  paymentId String?            @unique
  payment   Payment?           @relation(fields: [paymentId], references: [id])
  shift     Shift              @relation(fields: [shiftId], references: [id])
  user      User               @relation(fields: [userId], references: [id])

  @@map("registrations")
}

model Payment {
  id            String          @id @default(uuid())
  amount        Float
  currency      String          @default("USD")
  status        PaymentStatus   @default(PENDING)
  provider      PaymentProvider
  providerRefId String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  userId        String
  user          User            @relation(fields: [userId], references: [id])
  registration  Registration?

  @@map("payments")
}

model Notification {
  id        String             @id @default(uuid())
  type      NotificationType
  content   String
  recipient String
  status    NotificationStatus @default(PENDING)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt

  @@map("notifications")
}

model CoreConfig {
  id                       String     @id @default(uuid())
  campName                 String
  campDescription          String?
  homePageBlurb            String?
  campBannerUrl            String?
  campBannerAltText        String?
  campIconUrl              String?
  campIconAltText          String?
  registrationYear         Int
  earlyRegistrationOpen    Boolean    @default(false)
  registrationOpen         Boolean    @default(false)
  registrationTerms        String?
  allowDeferredDuesPayment Boolean    @default(false)
  stripeEnabled            Boolean    @default(false)
  stripePublicKey          String?
  stripeApiKey             String?
  stripeWebhookSecret      String?
  paypalEnabled            Boolean    @default(false)
  paypalClientId           String?
  paypalClientSecret       String?
  paypalMode               PaypalMode @default(SANDBOX)
  smtpHost                 String?
  smtpPort                 Int?
  smtpUser                 String?
  smtpPassword             String?
  smtpSecure               Boolean    @default(false)
  timeZone                 String     @default("UTC")
  createdAt                DateTime   @default(now())
  updatedAt                DateTime   @updatedAt

  @@map("core_config")
}

enum UserRole {
  ADMIN
  STAFF
  PARTICIPANT
}

enum FieldType {
  STRING
  MULTILINE_STRING
  INTEGER
  NUMBER
  BOOLEAN
  DATE
}

enum DayOfWeek {
  PRE_OPENING
  OPENING_SUNDAY
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  CLOSING_SUNDAY
  POST_EVENT
}

enum RegistrationStatus {
  PENDING
  CONFIRMED
  CANCELLED
  WAITLISTED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentProvider {
  STRIPE
  PAYPAL
}

enum NotificationType {
  EMAIL_VERIFICATION
  PASSWORD_RESET
  REGISTRATION_CONFIRMATION
  PAYMENT_CONFIRMATION
  SHIFT_REMINDER
}

enum NotificationStatus {
  PENDING
  SENT
  FAILED
}

enum PaypalMode {
  SANDBOX
  LIVE
}
